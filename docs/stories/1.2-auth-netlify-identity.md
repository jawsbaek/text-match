# Story 1.2: Authentication (Netlify Identity)

Status: Draft

## Story

As a user,
I want secure authentication via Netlify Identity (GoTrue),
so that only authorized users access the system.

## Acceptance Criteria

- Server routes verify GoTrue JWT (issuer/site from env)
- App metadata roles mapped into app context (ยง12)
- Guards/middleware enforce auth on /api/\*\* with 401/403 as appropriate

## Dev Notes

- PRD ยง12 Authentication & Authorization
- Use TanStack Start server routes; verify JWT, enrich context

## Tasks / Subtasks

- [ ] Configure Netlify Identity site env
- [ ] Implement JWT verification utility and middleware
- [ ] Protect /api/\*\* routes
- [ ] Map roles from token app_metadata
- [ ] Unit tests for 401/403 cases

## Testing

- Simulate valid/invalid JWTs against protected routes
- Verify role mapping present in context

## QA Results
